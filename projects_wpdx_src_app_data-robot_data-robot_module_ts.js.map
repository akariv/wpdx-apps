{"version":3,"file":"projects_wpdx_src_app_data-robot_data-robot_module_ts.js","mappings":"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","sources":["./projects/wpdx/src/app/data-robot/data-robot-routing.module.ts","./projects/wpdx/src/app/data-robot/data-robot.component.ts","./projects/wpdx/src/app/data-robot/data-robot.component.html","./projects/wpdx/src/app/data-robot/data-robot.module.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { DataRobotComponent } from './data-robot.component';\n\nconst routes: Routes = [{ path: '', component: DataRobotComponent }];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class DataRobotRoutingModule { }\n","import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\n\nimport * as mapboxgl from 'mapbox-gl';\n\nimport { LayoutService } from '../layout.service';\n@Component({\n  selector: 'app-data-robot',\n  templateUrl: './data-robot.component.html',\n  styleUrls: ['./data-robot.component.less']\n})\nexport class DataRobotComponent {\n\n  @ViewChild('popup') popup: ElementRef;\n\n  LAYERS = [\n    'datarobot-slim-last-known',\n    'datarobot-slim-year-0',\n    'datarobot-slim-year-1',\n    'datarobot-slim-year-3',\n  ];\n  TIMEFRAME_OPTIONS = [\n    {value: 'datarobot-slim-last-known', display: 'Last Known'},\n    {value: 'datarobot-slim-year-0', display: 'As of Today'},\n    {value: 'datarobot-slim-year-1', display: 'Today + 1'},\n    {value: 'datarobot-slim-year-3', display: 'Today + 3'},\n    {value: 'combined', display: 'Combined View'},\n  ];\n  _layer = '';\n  _map: mapboxgl.Map;\n\n  popupProperties: any = {};\n\n\n  constructor(public layout: LayoutService) {\n  }\n\n  set map(value) {\n    this._map = value;\n    this._map.on('style.load', () => {\n      this.layer = this.LAYERS[0];\n    });\n  }\n\n  get map() {\n    return this._map;\n  }\n\n  set layer(value) {\n    this._layer = value;\n    for (const layer of this.LAYERS) {\n      if (value === layer || value === 'combined') {\n        this.map.setLayoutProperty(layer, 'visibility', 'visible');\n      }\n    }\n    for (const layer of this.LAYERS) {\n      if (value !== layer && value !== 'combined') {\n        this.map.setLayoutProperty(layer, 'visibility', 'none');\n      }\n    }\n  }\n\n  get layer() {\n    return this._layer;\n  }\n\n  handleState(state) {\n    this.map.fitBounds(state.bounds);\n    const filter: any[] = [\n      'all'\n    ];\n    for (const f of ['country_name', 'adm1', 'adm2', 'adm3', 'adm4']) {\n      if (state[f]) {\n        filter.push([\n          '==', ['get', f], ['literal', state[f]]\n        ]);\n      }\n    }\n    for (const layer of this.LAYERS) {\n      this.map.setFilter(layer, filter);\n    }\n    filter.push(['!=', ['get', 'photo_lnk'], '']);\n    this.map.setFilter('datarobot-slim-photos', filter);\n  }\n}\n","<app-airtable-layout \n    id='status-predictions'\n    mapStyle='mapbox://styles/wpdx/ckl88cymr11bm17o2bj8rgiut'\n    [interactionLayers]='LAYERS'\n    (map)='map = $event'\n    (mapPopup)='popupProperties = $event'\n>\n    <div class='workspace' ngProjectAs='.content'>\n        <app-controls>\n            <app-legend-control>\n                <p class='legend-row'><span class='status-circle functional'></span>&nbsp;Functional Water Point</p>\n                <p class='legend-row'><span class='status-circle'></span>&nbsp;Non-Functional Water Point</p>\n            </app-legend-control>\n            <app-filters-control>\n                <app-custom-selector [(value)]='layer' title='Timeframe' [options]='TIMEFRAME_OPTIONS'></app-custom-selector>\n                <app-adm-selector optionsUrl='/assets/status-predictions/levels.json' (state)='handleState($event)'></app-adm-selector>\n            </app-filters-control>\n        </app-controls>\n    </div>\n    <div class='map-popup'>\n        <p>\n            <mat-icon>invert_colors</mat-icon>&nbsp;<label>Status:</label> \n        </p>\n        <div class='popup-functionality'>\n            <div class='popup-functionality-single'>\n                <div class='status-circle' [class.functional]='popupProperties.status_id === \"Yes\"'></div>\n                <!-- <div class='status-text'>{{popupProperties.status_id}}</div> -->\n                <div class='status-date'>Last Known<br/>{{popupProperties.report_date}}</div>    \n            </div>\n            <div class='popup-functionality-single'>\n                <div class='status-circle' [class.functional]='popupProperties.status_0 === \"YES\"'></div>\n                <!-- <div class='status-text'>{{popupProperties.status_id}}</div> -->\n                <div class='status-date'>As of today</div>    \n                <div class='status-prob'>p: {{popupProperties.status_0_prob * 100 | number:'1.0-0'}}%</div>    \n            </div>\n            <div class='popup-functionality-single'>\n                <div class='status-circle' [class.functional]='popupProperties.status_1 === \"YES\"'></div>\n                <!-- <div class='status-text'>{{popupProperties.status_1}}</div> -->\n                <div class='status-date'>Today + 1</div>    \n                <div class='status-prob'>p: {{popupProperties.status_1_prob * 100 | number:'1.0-0'}}%</div>    \n            </div>\n            <div class='popup-functionality-single'>\n                <div class='status-circle' [class.functional]='popupProperties.status_3 === \"YES\"'></div>\n                <!-- <div class='status-text'>{{popupProperties.status_3}}</div> -->\n                <div class='status-date'>Today + 3</div>    \n                <div class='status-prob'>p: {{popupProperties.status_3_prob * 100 | number:'1.0-0'}}%</div>    \n            </div>\n        </div>\n    </div>\n</app-airtable-layout>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DataRobotRoutingModule } from './data-robot-routing.module';\nimport { DataRobotComponent } from './data-robot.component';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { CommonComponentsModule } from '../common-components/common-components.module';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSelectModule } from '@angular/material/select';\n\n\n@NgModule({\n  declarations: [\n    DataRobotComponent\n  ],\n  imports: [\n    CommonModule,\n    DataRobotRoutingModule,\n    CommonComponentsModule,\n    FormsModule,\n    MatIconModule,\n  ]\n})\nexport class DataRobotModule { }\n"],"names":[],"sourceRoot":"webpack:///"}