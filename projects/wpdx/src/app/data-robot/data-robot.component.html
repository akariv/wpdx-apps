<app-airtable-layout 
    id='status-predictions'
    mapStyle='mapbox://styles/wpdx/ckl88cymr11bm17o2bj8rgiut'
    [interactionLayers]='LAYERS'
    (map)='map = $event'
    (mapPopup)='popupProperties = $event'
>
    <div class='workspace' ngProjectAs='.content'>
        <div class='controls'>
            <mat-expansion-panel [expanded]='true'>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Legend
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <p class='legend-row'><span class='status-circle functional'></span>&nbsp;Functional Water Point</p>
                <p class='legend-row'><span class='status-circle'></span>&nbsp;Non-Functional Water Point</p>
            </mat-expansion-panel>
            <p></p>
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Filter & Search
                  </mat-panel-title>
                  <mat-panel-description>
                    <mat-icon fontSet='material-icons-outlined'>filter_alt</mat-icon>
                  </mat-panel-description>
                </mat-expansion-panel-header>
    
                <div>
                    <mat-card>
                        <mat-card-title i18n>Timeframe</mat-card-title>
                        <mat-card-actions>
                            <mat-select [(value)]='layer'>
                                <mat-option value="datarobot-slim-last-known">Last Known</mat-option>
                                <mat-option value="datarobot-slim-year-0">As of Today</mat-option>
                                <mat-option value="datarobot-slim-year-1">Today + 1</mat-option>
                                <mat-option value="datarobot-slim-year-3">Today + 3</mat-option>
                                <mat-option value="combined">Combined View</mat-option>
                            </mat-select>                
                        </mat-card-actions>
                    </mat-card>
                    <app-adm-selector optionsUrl='/assets/status-predictions/levels.json' (state)='handleState($event)'></app-adm-selector>
                </div>
            </mat-expansion-panel>
        </div>
    </div>
    <div class='map-popup'>
        <p>
            <mat-icon>invert_colors</mat-icon>&nbsp;<label>Status:</label> 
        </p>
        <div class='popup-functionality'>
            <div class='popup-functionality-single'>
                <div class='status-circle' [class.functional]='popupProperties.status_id === "Yes"'></div>
                <!-- <div class='status-text'>{{popupProperties.status_id}}</div> -->
                <div class='status-date'>Last Known<br/>{{popupProperties.report_date}}</div>    
            </div>
            <div class='popup-functionality-single'>
                <div class='status-circle' [class.functional]='popupProperties.status_0 === "YES"'></div>
                <!-- <div class='status-text'>{{popupProperties.status_id}}</div> -->
                <div class='status-date'>As of today</div>    
                <div class='status-prob'>p: {{popupProperties.status_0_prob * 100 | number:'1.0-0'}}%</div>    
            </div>
            <div class='popup-functionality-single'>
                <div class='status-circle' [class.functional]='popupProperties.status_1 === "YES"'></div>
                <!-- <div class='status-text'>{{popupProperties.status_1}}</div> -->
                <div class='status-date'>Today + 1</div>    
                <div class='status-prob'>p: {{popupProperties.status_1_prob * 100 | number:'1.0-0'}}%</div>    
            </div>
            <div class='popup-functionality-single'>
                <div class='status-circle' [class.functional]='popupProperties.status_3 === "YES"'></div>
                <!-- <div class='status-text'>{{popupProperties.status_3}}</div> -->
                <div class='status-date'>Today + 3</div>    
                <div class='status-prob'>p: {{popupProperties.status_3_prob * 100 | number:'1.0-0'}}%</div>    
            </div>
        </div>
    </div>
</app-airtable-layout>